{% extends "base.html" %}

{% block title %}Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ{% endblock %}

{% block breadcrumb %}
<a href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a> / <span>Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</span>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">
            <div class="avatar-circle">
                <span class="avatar-text">{{ current_user.full_name|first_letter }}</span>
            </div>
            <div class="profile-info">
                <h1>{{ current_user.full_name }}</h1>
                <p class="username">@{{ current_user.username }}</p>
                <div class="user-badges">
                    {% if current_user.is_admin %}
                        <span class="badge badge-admin">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    {% endif %}
                    {% if current_user.is_college_admin %}
                        <span class="badge badge-college-admin">Ù…Ø¯ÙŠØ± Ø§Ù„ÙƒÙ„ÙŠØ©</span>
                    {% endif %}
                    {% if current_user.is_hod %}
                        <span class="badge badge-hod">Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù…</span>
                    {% endif %}
                    {% if current_user.is_doc %}
                        <span class="badge badge-doc">Ø·Ø¨ÙŠØ¨ Ø§Ù„ÙƒÙ„ÙŠØ©</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="profile-content">
        <div class="profile-tabs">
            <button class="tab-button active" onclick="showTab('profile')">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</button>
            <button class="tab-button" onclick="showTab('security')">Ø§Ù„Ø£Ù…Ø§Ù†</button>
        </div>

        
        <div id="profile-tab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                </div>
                <div class="card-body">
                    {% if success %}
                        <div class="alert alert-success">{{ success }}</div>
                    {% endif %}
                    {% if error %}
                        <div class="alert alert-danger">{{ error }}</div>
                    {% endif %}

                    <form method="post" action="/profile/update-profile">
                        <div class="form-group">
                            <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" id="username" value="{{ current_user.username }}" disabled class="form-control disabled">
                            <small class="form-text">Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</small>
                        </div>

                        <div class="form-group">
                            <label for="full_name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <input type="text" id="full_name" name="full_name" value="{{ current_user.full_name }}" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                            <div class="account-type">
                                {% if current_user.is_admin %}
                                    <span>Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                                {% elif current_user.is_college_admin %}
                                    <span>Ù…Ø¯ÙŠØ± Ø§Ù„ÙƒÙ„ÙŠØ© - {{ current_user.college_admin_college or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</span>
                                {% elif current_user.is_hod %}
                                    <span>Ø±Ø¦ÙŠØ³ Ø§Ù„Ù‚Ø³Ù… - {{ current_user.hod_college or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</span>
                                {% elif current_user.is_doc %}
                                    <span>Ø·Ø¨ÙŠØ¨ Ø§Ù„ÙƒÙ„ÙŠØ©</span>
                                {% else %}
                                    <span>Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        
        <div id="security-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                </div>
                <div class="card-body">
                    {% if success and request.url.path == '/profile/change-password' %}
                        <div class="alert alert-success">{{ success }}</div>
                    {% endif %}
                    {% if error and request.url.path == '/profile/change-password' %}
                        <div class="alert alert-danger">{{ error }}</div>
                    {% endif %}

                    <form method="post" action="/profile/change-password">
                        <div class="form-group">
                            <label for="current_password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                            <input type="password" id="current_password" name="current_password" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="new_password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                            <input type="password" id="new_password" name="new_password" class="form-control" required minlength="6">
                            <small class="form-text">ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</small>
                        </div>

                        <div class="form-group">
                            <label for="confirm_password">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                            <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                        </div>

                        <div class="password-strength" id="password-strength" style="display: none;">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strength-fill"></div>
                            </div>
                            <span class="strength-text" id="strength-text"></span>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                ğŸ”’ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="security-tips">
                <h4>ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©:</h4>
                <ul>
                    <li>Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø²ÙŠØ¬Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØ§Ù„ØµØºÙŠØ±Ø©</li>
                    <li>Ø£Ø¶Ù Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ ÙˆØ±Ù…ÙˆØ²Ø§Ù‹ Ø®Ø§ØµØ©</li>
                    <li>ØªØ¬Ù†Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©</li>
                    <li>Ø§Ø¬Ø¹Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</li>
                    <li>Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ù†ÙØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ Ø£ÙƒØ«Ø± Ù…Ù† Ù…ÙˆÙ‚Ø¹</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
/* ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
.profile-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.profile-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 20px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.profile-avatar {
    display: flex;
    align-items: center;
    gap: 20px;
}

.avatar-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: bold;
    backdrop-filter: blur(10px);
}

.avatar-text {
    color: white;
}

.profile-info h1 {
    margin: 0 0 5px 0;
    font-size: 24px;
    font-weight: 700;
}

.username {
    margin: 0 0 15px 0;
    opacity: 0.8;
    font-size: 14px;
}

.user-badges {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-admin { background: #ff6b6b; color: white; }
.badge-college-admin { background: #4ecdc4; color: white; }
.badge-hod { background: #45b7d1; color: white; }
.badge-doc { background: #96ceb4; color: white; }

.profile-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    border-bottom: 2px solid #e9ecef;
}

.tab-button {
    padding: 12px 24px;
    border: none;
    background: none;
    color: #6c757d;
    font-weight: 600;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
}

.tab-button.active {
    color: #667eea;
    border-bottom-color: #667eea;
}

.tab-button:hover {
    color: #667eea;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.card-header {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

.card-header h3 {
    margin: 0;
    color: #2c3e50;
    font-weight: 600;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

.form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-control.disabled {
    background: #f8f9fa;
    color: #6c757d;
}

.form-text {
    display: block;
    margin-top: 5px;
    font-size: 12px;
    color: #6c757d;
}

.account-type {
    padding: 10px 15px;
    background: #f8f9fa;
    border-radius: 8px;
    color: #2c3e50;
    font-weight: 500;
}

.form-actions {
    margin-top: 25px;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.security-tips {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 15px;
    border-left: 4px solid #667eea;
}

.security-tips h4 {
    margin: 0 0 15px 0;
    color: #2c3e50;
}

.security-tips ul {
    margin: 0;
    padding-right: 20px;
}

.security-tips li {
    margin-bottom: 8px;
    color: #6c757d;
}

.password-strength {
    margin: 15px 0;
}

.strength-bar {
    height: 4px;
    background: #e9ecef;
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 5px;
}

.strength-fill {
    height: 100%;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.strength-text {
    font-size: 12px;
    font-weight: 600;
}

.alert {
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: none;
}

.alert-success {
    background: #d4edda;
    color: #155724;
}

.alert-danger {
    background: #f8d7da;
    color: #721c24;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.profile-container {
    animation: fadeIn 0.5s ease;
}
</style>

<script>
// Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function showTab(tabName) {
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    event.target.classList.add('active');
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
document.getElementById('new_password').addEventListener('input', function() {
    const password = this.value;
    const strengthDiv = document.getElementById('password-strength');
    const strengthFill = document.getElementById('strength-fill');
    const strengthText = document.getElementById('strength-text');
    
    if (password.length === 0) {
        strengthDiv.style.display = 'none';
        return;
    }
    
    strengthDiv.style.display = 'block';
    
    // Ø­Ø³Ø§Ø¨ Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    let strength = 0;
    
    if (password.length >= 6) strength++;
    if (password.length >= 8) strength++;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
    if (/\d/.test(password)) strength++;
    if (/[^a-zA-Z\d]/.test(password)) strength++;
    
    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ù‚ÙˆØ©
    if (strength <= 2) {
        strengthFill.style.width = '33%';
        strengthFill.style.background = '#dc3545';
        strengthText.textContent = 'Ø¶Ø¹ÙŠÙØ©';
        strengthText.style.color = '#dc3545';
    } else if (strength <= 3) {
        strengthFill.style.width = '66%';
        strengthFill.style.background = '#ffc107';
        strengthText.textContent = 'Ù…ØªÙˆØ³Ø·Ø©';
        strengthText.style.color = '#ffc107';
    } else {
        strengthFill.style.width = '100%';
        strengthFill.style.background = '#28a745';
        strengthText.textContent = 'Ù‚ÙˆÙŠØ©';
        strengthText.style.color = '#28a745';
    }
});

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±
document.getElementById('confirm_password').addEventListener('input', function() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = this.value;
    
    if (confirmPassword.length > 0) {
        if (newPassword !== confirmPassword) {
            this.style.borderColor = '#dc3545';
        } else {
            this.style.borderColor = '#28a745';
        }
    } else {
        this.style.borderColor = '#e9ecef';
    }
});
</script>
{% endblock %}