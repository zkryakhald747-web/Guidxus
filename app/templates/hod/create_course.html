{% extends "base.html" %}

{% block breadcrumb %}
  <a href="/hod/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a> â€º <span>{{ 'ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙˆØ±Ø©' if edit_mode else 'Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ±Ø©' }}</span>
{% endblock %}

{% block content %}

{% if request.query_params.get("created") and not edit_mode %}
  <div class="alert alert-success prestige">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ±Ø© ÙˆÙ†Ø´Ø±Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­.</div>
{% endif %}


<style>
  .checkbox-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 12px;
    margin-top: 8px;
  }
  .checkbox-grid .checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border: 1px solid #eee;
    border-radius: 12px;
    background: #fff;
    transition: box-shadow .15s ease, border-color .15s ease;
  }
  .checkbox-grid .checkbox:hover {
    border-color: #dcdcdc;
    box-shadow: 0 2px 8px rgba(0,0,0,.04);
  }
  .checkbox-grid input[type="checkbox"] { transform: scale(1.05); }
  .checkbox-grid span { line-height: 1.6; }

  .dep-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    margin: 8px 0 4px;
  }
  .dep-toolbar input[type="search"]{
    padding: 8px 10px;
    border: 1px solid #e6e6e6;
    border-radius: 10px;
    min-width: 260px;
  }
  .muted { color: #6b7280; font-size: .92rem; }
</style>

{# Ù†Ø­Ø¯Ø¯ c = course Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ ÙˆÙ†Ø³ØªØ¹Ù…Ù„ selected_department_ids Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© #}
{% set c = course if (edit_mode and course is defined) else None %}
{% set mode_val = (c.mode if c else '') %}
{% set selected_ids = (selected_department_ids if (edit_mode and selected_department_ids is defined) else []) %}

<form class="form prestige-form" method="post" action="{{ '/hod/courses/' ~ c.id ~ '/edit' if c else '/hod/courses/new' }}">
  
  <section class="card card-prestige">
    <div class="card-head">
      <div class="card-icon">ğŸ“</div>
      <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©</h3>
    </div>
    <div class="grid">
      <label>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©
        <input type="text" name="title" required placeholder="Ù…Ø«Ø§Ù„: Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„ÙˆØ±Ø´" value="{{ c.title if c else '' }}">
      </label>

      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª
        <input type="number" name="hours" step="0.5" min="0.5" required value="{{ c.hours if c else '' }}">
      </label>

      <label>Ø¢Ù„ÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°
        <select name="mode" required>
          <option value="in_person" {{ 'selected' if mode_val in ['in_person','Ø­Ø¶ÙˆØ±ÙŠ','Ø­Ø¶ÙˆØ±ÙŠ '] else '' }}>Ø­Ø¶ÙˆØ±ÙŠ</option>
          <option value="online"    {{ 'selected' if mode_val in ['online','remote','Ø¹Ù† Ø¨ÙØ¹Ø¯','Ø¹Ù† Ø¨Ø¹Ø¯'] else '' }}>Ø¹Ù† Ø¨ÙØ¹Ø¯</option>
        </select>
      </label>

      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        <input type="date" name="start_date" required
               value="{{ (c.start_date.strftime('%Y-%m-%d') if c and c.start_date else '') }}">
      </label>

      <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        <input type="date" name="end_date" required
               value="{{ (c.end_date.strftime('%Y-%m-%d') if c and c.end_date else '') }}">
      </label>
    </div>

    <div class="grid">
      <label>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ÙØ°Ø©
        <input type="text" name="provider" placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø±ÙƒØ¨Ø§Øª" value="{{ c.provider if c else '' }}">
      </label>

      
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ÙÙ‘ÙØ°
        <input type="text" name="provider_name" placeholder="Ù…Ø«Ø§Ù„: Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ" value="{{ c.provider_name if c else '' }}">
      </label>

      <label>ÙˆØµÙ Ù…Ø®ØªØµØ±
        <textarea name="description" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙˆØ±Ø© ÙˆØ£Ù‡Ø¯Ø§ÙÙ‡Ø§">{{ c.description if c else '' }}</textarea>
      </label>
    </div>
  </section>

  
  <section class="card card-prestige">
    <div class="card-head">
      <div class="card-icon">ğŸ—‚ï¸</div>
      <h3>Ø§Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù</h3>
    </div>
    <div class="muted">Ø§Ø®ØªØ± Ø£Ù‚Ø³Ø§Ù…Ù‹Ø§ Ù…Ø³ØªÙ‡Ø¯ÙØ© (ÙŠÙ…ÙƒÙ† Ù…ØªØ¹Ø¯Ø¯Ø©):</div>

    <div class="dep-toolbar">
      <input type="search" id="dep-filter" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø³Ù…â€¦ (Ù…Ø«Ø§Ù„: Ù…Ø­Ø§Ø³Ø¨Ø©, Ø´Ø¨ÙƒØ§Øª)">
    </div>

    <div class="checkbox-grid" id="dep-grid">
      {% for dep in departments %}
        <label class="checkbox">
          <input type="checkbox" name="target_department_ids" value="{{ dep.id }}"
                 {% if edit_mode and (dep.id in selected_ids) %}checked{% endif %}>
          <span>{{ dep.name }}</span>
        </label>
      {% else %}
        <div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</div>
      {% endfor %}
    </div>
  </section>

  
  <section class="card card-prestige">
    <div class="card-head">
      <div class="card-icon">ğŸ“</div>
      <h3>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø³Ø¹Ø©</h3>
    </div>
    <div class="grid">
      <label>Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰
        <input type="number" name="capacity" min="1" required value="{{ c.capacity if c else 30 }}">
      </label>

      <label>Ø³ÙŠØ§Ø³Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        {% set policy = c.registration_policy if c else 'open' %}
        <div class="inline">
          <label class="radio"><input type="radio" name="registration_policy" value="open"     {{ 'checked' if policy=='open' else '' }}> Ù…ÙØªÙˆØ­ Ù…Ø¨Ø§Ø´Ø±Ø©</label>
          <label class="radio"><input type="radio" name="registration_policy" value="approval" {{ 'checked' if policy=='approval' else '' }}> ÙŠØªØ·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø©</label>
          <label class="radio"><input type="radio" name="registration_policy" value="waitlist" {{ 'checked' if policy=='waitlist' else '' }}> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù†ØªØ¸Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</label>
        </div>
      </label>

      <label class="toggle">Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ù†ÙØ³ Ø§Ù„Ù…ØªØ¯Ø±Ø¨
        <input type="checkbox" name="prevent_duplicates" {{ 'checked' if (c and c.prevent_duplicates) or (not c) else '' }}>
        <span class="slider"></span>
      </label>
    </div>
  </section>

  
  <section class="card card-prestige">
    <div class="card-head">
      <div class="card-icon">âš™ï¸</div>
      <h3>Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
    </div>
    <div class="grid">
      {% set av = c.attendance_verification if c else 'paper' %}
      <label>Ø¢Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚
        <select name="attendance_verification">
          <option value="paper" {{ 'selected' if av=='paper' else '' }}>ÙƒØ´Ù ÙˆØ±Ù‚ÙŠ</option>
          <option value="qr"    {{ 'selected' if av=='qr' else '' }}>QR Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)</option>
        </select>
      </label>

      <label>Ø´Ø±Ø· Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„ Ù„Ø¥ØµØ¯Ø§Ø± Ø´Ù‡Ø§Ø¯Ø© (%)
        <input type="number" name="completion_threshold" min="0" max="100" value="{{ c.completion_threshold if c else 80 }}">
      </label>
    </div>
  </section>

  
  <section class="card card-prestige">
    <div class="card-head">
      <div class="card-icon">ğŸ“„</div>
      <h3>Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª</h3>
    </div>
    <label class="checkbox">
      <input type="checkbox" name="create_expected_roster" {{ 'checked' if (c and c.create_expected_roster) or (not c) else '' }}>
      <span>ØªÙ…ÙƒÙŠÙ† Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ´Ù Ù…ØªÙˆÙ‚Ø¹ Ù„Ù„Ø­Ø¶ÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
    </label>
    <label class="checkbox">
      <input type="checkbox" name="auto_issue_certificates" {{ 'checked' if (c and c.auto_issue_certificates) or (not c) else '' }}>
      <span>ØªÙØ¹ÙŠÙ„ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</span>
    </label>
  </section>

  <div class="actions actions-prestige">
    <button type="submit" class="btn btn-primary btn-prestige">{{ 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' if c else 'Ù†Ø´Ø± Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø¢Ù†' }}</button>
    <a class="btn btn-secondary" href="/hod/">{{ 'Ø±Ø¬ÙˆØ¹' if c else 'Ø¥Ù„ØºØ§Ø¡' }}</a>
  </div>
</form>


<script>
  (function () {
    const input = document.getElementById('dep-filter');
    const grid = document.getElementById('dep-grid');
    if (!input || !grid) return;

    input.addEventListener('input', function () {
      const term = this.value.trim().toLowerCase();
      const items = grid.querySelectorAll('label.checkbox');
      items.forEach((el) => {
        const text = (el.textContent || '').toLowerCase();
        el.style.display = text.includes(term) ? '' : 'none';
      });
    });
  })();
</script>

{% endblock %}
