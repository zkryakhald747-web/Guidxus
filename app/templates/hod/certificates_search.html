{% extends "base.html" %}

{% block title %}Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-md-10 offset-md-1">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">ğŸ–ï¸ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</h4>
        </div>
        <div class="card-body">
          
          <form method="get" action="/hod/certificates/issue" class="mb-4">
            <div class="input-group input-group-lg">
              <input 
                type="text" 
                name="search" 
                class="form-control" 
                placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…... (Ù…Ø«Ø§Ù„: 123456789)"
                value="{{ search }}"
                autofocus
              />
              <button class="btn btn-primary" type="submit">ğŸ” Ø¨Ø­Ø«</button>
              {% if search %}
                <a href="/hod/certificates/issue" class="btn btn-secondary">ğŸ”„ Ù…Ø³Ø­</a>
              {% endif %}
            </div>
          </form>

          {% if search %}
            
            {% if trainee_info %}
              <div class="alert alert-success alert-dismissible fade show">
                <h5 class="alert-heading">âœ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨</h5>
                <div class="row">
                  <div class="col-md-6">
                    <strong>Ø§Ù„Ø±Ù‚Ù…:</strong> {{ trainee_info.trainee_no }}<br/>
                    <strong>Ø§Ù„Ø§Ø³Ù…:</strong> {{ trainee_info.trainee_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}<br/>
                  </div>
                  <div class="col-md-6">
                    <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª:</strong> <span class="badge bg-info">{{ trainee_info.total_certificates }}</span><br/>
                    <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</strong> <span class="badge bg-success">{{ trainee_info.total_hours }}</span>
                  </div>
                </div>
              </div>

              
              <div class="table-responsive">
                <table class="table table-hover table-striped table-sm">
                  <thead class="table-primary sticky-top">
                    <tr>
                      <th width="5%">Ù…</th>
                      <th width="15%">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th>
                      <th width="8%">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                      <th width="12%">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
                      <th width="12%">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
                      <th width="18%">ÙƒÙˆØ¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</th>
                      <th width="15%">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</th>
                      <th width="15%">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for cert in certificates %}
                      <tr>
                        <td><strong>{{ loop.index }}</strong></td>
                        <td>
                          <strong>{{ cert.course_title or 'Ø¯ÙˆØ±Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†' }}</strong>
                        </td>
                        <td>
                          {% if cert.hours %}
                            <span class="badge bg-info">{{ cert.hours }}</span>
                          {% else %}
                            <span class="badge bg-secondary">---</span>
                          {% endif %}
                        </td>
                        <td>
                          {% if cert.start_date %}
                            <small>
                              {% if cert.start_date is string %}
                                {{ cert.start_date }}
                              {% else %}
                                {{ cert.start_date.strftime('%d/%m/%Y') }}
                              {% endif %}
                            </small>
                          {% else %}
                            <small class="text-muted">---</small>
                          {% endif %}
                        </td>
                        <td>
                          {% if cert.end_date %}
                            <small>
                              {% if cert.end_date is string %}
                                {{ cert.end_date }}
                              {% else %}
                                {{ cert.end_date.strftime('%d/%m/%Y') }}
                              {% endif %}
                            </small>
                          {% else %}
                            <small class="text-muted">---</small>
                          {% endif %}
                        </td>
                        <td>
                          <code class="bg-light p-1">{{ cert.certificate_code }}</code>
                        </td>
                        <td>
                          {% if cert.created_at %}
                            <small>
                              {% if cert.created_at is string %}
                                {{ cert.created_at }}
                              {% else %}
                                {{ cert.created_at.strftime('%d/%m/%Y %H:%M') }}
                              {% endif %}
                            </small>
                          {% else %}
                            <small class="text-muted">---</small>
                          {% endif %}
                        </td>
                        <td>
                          <div class="btn-group btn-group-sm" role="group">
                            <a href="/verify/{{ cert.certificate_code }}" class="btn btn-info" target="_blank" title="Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©">
                              âœ“ ØªØ­Ù‚Ù‚
                            </a>
                            <a href="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data={{ cert.certificate_code }}" class="btn btn-secondary" target="_blank" title="Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
                              ğŸ“Š QR
                            </a>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

              <div class="alert alert-info mt-3">
                <strong>ğŸ“Š Ù…Ù„Ø®Øµ:</strong> Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª: <strong>{{ trainee_info.total_certificates }}</strong> | Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª: <strong>{{ trainee_info.total_hours }}</strong>
              </div>
            {% else %}
              <div class="alert alert-warning">
                âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø§Øª Ù„Ù„Ù…ØªØ¯Ø±Ø¨: <strong>{{ search }}</strong>
              </div>
            {% endif %}
          {% else %}
            <div class="alert alert-info" style="border-left: 4px solid #0d6efd;">
              <h5>ğŸ“ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</h5>
              <ul class="mb-0">
                <li>Ø£Ø¯Ø®Ù„ <strong>Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</strong> (Ù…Ø«Ø§Ù„: 123456789) Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø´Ù‡Ø§Ø¯Ø§ØªÙ‡</li>
                <li>Ø£Ùˆ Ø£Ø¯Ø®Ù„ <strong>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</strong> (Ø­ØªÙ‰ Ù„Ùˆ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø§Ø³Ù…)</li>
                <li>Ø³ØªØ¸Ù‡Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªÙŠ Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø© ÙÙŠÙ‡Ø§ Ù…Ø¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©</li>
              </ul>
            </div>
          {% endif %}
        </div>
      </div>

      
      <div class="mt-3">
        <a href="{{ back_url }}" class="btn btn-secondary btn-lg">â† Ø¹ÙˆØ¯Ø©</a>
      </div>
    </div>
  </div>
</div>

<style>
  .sticky-top {
    background-color: #fff;
    z-index: 10;
  }
  .table-hover tbody tr:hover {
    background-color: #f8f9fa;
  }
  code {
    color: #d63384;
    word-break: break-all;
  }
</style>
{% endblock %}

