{% extends "base.html" %}

{% block breadcrumb %}
  <a href="/admin/">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</a> â€º <span>Ø§Ù„ÙƒÙ„ÙŠØ§Øª</span>
{% endblock %}

{% block content %}
<style>
  .toolbar { display:flex; gap:10px; align-items:center; justify-content:flex-end; margin-bottom:12px; }
  .toolbar .grow { margin-inline-start:auto; }
  table.tbl { width:100%; border-collapse:separate; border-spacing:0; }
  table.tbl th, table.tbl td { padding:12px 14px; border-bottom:1px solid #eee; background:#fff; }
  table.tbl th { background:#f8fafb; text-align:right; font-weight:700; color:#374151; }
  .badge { display:inline-block; padding:4px 10px; border-radius:999px; font-size:.85rem; }
  .badge-on { background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; }
  .badge-off { background:#fff1f2; color:#b91c1c; border:1px solid #fecdd3; }
  .muted { color:#6b7280; }
</style>

<div class="card">
  <div class="card-head">
    <div class="card-icon">ğŸ“</div>
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙ„ÙŠØ§Øª</h3>
  </div>

  <div class="toolbar">
    <form class="grow" method="get" action="/admin/colleges">
      <input type="search" name="q" value="{{ q }}" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ©â€¦">
      <button class="btn btn-secondary" type="submit">Ø¨Ø­Ø«</button>
    </form>
    {% if not current_user or not current_user.is_college_admin %}
    <a class="btn btn-primary" href="/admin/colleges/new">â• Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ÙŠØ©</a>
    {% else %}
    <button class="btn btn-primary" disabled>â• Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ÙŠØ©</button>
    {% endif %}
  </div>

  <div class="table-wrap">
    <table class="tbl">
      <thead>
        <tr>
          <th style="width:24%">Ø§Ø³Ù… Ø§Ù„ÙƒÙ„ÙŠØ©</th>
          <th style="width:19%">Ø¹Ù…ÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠØ©</th>
          <th style="width:19%">ÙˆÙƒÙŠÙ„ Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</th>
          <th style="width:19%">ÙˆÙƒÙŠÙ„ Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ†</th>
          <th style="width:9%">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th style="width:10%">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for c in items %}
        {% set norm = c.name.strip().split()|join(' ') %}
        <tr>
          <td>
            {{ c.name }}
            {% if dep_counts_norm.get(norm) %}
              <div class="muted" style="font-size:.85rem">Ø£Ù‚Ø³Ø§Ù… Ù…Ø±ØªØ¨Ø·Ø©: {{ dep_counts_norm.get(norm) }}</div>
            {% endif %}
            {% if c.is_virtual %}
              <div class="muted" style="font-size:.85rem">ØºÙŠØ± Ù…ÙØ³Ø¬Ù‘Ù„Ø© Ø¨Ø¹Ø¯ â€” Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
            {% endif %}
          </td>
          <td>{{ c.dean_name or 'â€”' }}</td>
          <td>{{ c.vp_students_name or 'â€”' }}</td>
          <td>{{ c.vp_trainers_name or 'â€”' }}</td>
          <td>
            {% if not c.is_virtual and c.is_active %}
              <span class="badge badge-on">Ù†Ø´Ø·Ø©</span>
            {% else %}
              <span class="badge badge-off">{{ 'ØºÙŠØ± Ù†Ø´Ø·Ø©' if not c.is_virtual else 'ØºÙŠØ± Ù…ÙØ³Ø¬Ù‘Ù„Ø©' }}</span>
            {% endif %}
          </td>
          <td class="actions">
            {% if c.is_virtual %}
              <a class="btn btn-secondary" href="/admin/colleges/new?name={{ c.name | urlencode }}">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
            {% else %}
              <a class="btn btn-secondary" href="/admin/colleges/{{ c.id }}/edit">ØªØ¹Ø¯ÙŠÙ„</a>
              <form method="post" action="/admin/colleges/{{ c.id }}/toggle" style="display:inline">
                <button class="btn btn-secondary" type="submit">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</button>
              </form>
              <form method="post" action="/admin/colleges/{{ c.id }}/delete" style="display:inline" onsubmit="return confirm('Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙ„ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§. Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')">
                <button class="btn btn-secondary" type="submit">Ø­Ø°Ù</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„ÙŠØ§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
